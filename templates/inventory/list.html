{% extends "base.html" %}

{% block title %}Inventory - Restaurant Management{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Inventory Management</h1>
    <div style="display: flex; gap: 0.5rem;">
        <a href="{{ url_for('new_inventory') }}" class="button button-primary">‚ûï New Item</a>
        <a href="{{ url_for('export_inventory_csv') }}" class="button button-success">üì• Export</a>
    </div>
</div>

<!-- Low Stock Alerts -->
{% if low_stock %}
<div class="content-box" style="border-left: 4px solid #e74c3c;">
    <div class="box-header" style="color: #e74c3c;">‚ö†Ô∏è Low Stock Alerts</div>
    
    <table class="data-table">
        <thead>
            <tr>
                <th>Item</th>
                <th>Current Stock</th>
                <th>Minimum Level</th>
                <th>Stock %</th>
                <th>Supplier</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for item in low_stock %}
            <tr>
                <td><strong>{{ item.item_name }}</strong></td>
                <td>{{ item.quantity if item.quantity is not none else 0 }} {{ item.unit }}</td>
                <td>{{ item.minimum_stock_level if item.minimum_stock_level is not none else 0 }} {{ item.unit }}</td>
                <td>
                    <span class="label label-danger">{{ "%.1f"|format(item.stock_percentage if item.stock_percentage is not none else 0) }}%</span>
                </td>
                <td>{{ item.supplier_name if item.supplier_name else 'N/A' }}</td>
                <td>
                    <button onclick="showRestockModal({{ item.inventory_id }}, '{{ item.item_name }}')" 
                            class="button button-small button-primary">Restock</button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

<!-- All Inventory -->
<div class="content-box">
    <div class="box-header">All Inventory Items</div>
    
    <table class="data-table">
        <thead>
            <tr>
                <th>Item</th>
                <th>Category</th>
                <th>Quantity</th>
                <th>Min Level</th>
                <th>Supplier</th>
                <th>Unit Cost</th>
                <th>Last Restocked</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for item in inventory %}
            <tr>
                <td>{{ item.item_name }}</td>
                <td>{{ item.category }}</td>
                <td>{{ item.quantity if item.quantity is not none else 0 }} {{ item.unit }}</td>
                <td>{{ item.minimum_stock_level if item.minimum_stock_level is not none else 0 }} {{ item.unit }}</td>
                <td>{{ item.supplier_name if item.supplier_name else 'N/A' }}</td>
                <td>${{ "%.2f"|format(item.unit_cost if item.unit_cost is not none else 0) }}</td>
                <td>{{ item.last_restocked_date if item.last_restocked_date else 'Never' }}</td>
                <td>
                    <a href="{{ url_for('edit_inventory', inventory_id=item.inventory_id) }}" 
                       class="button button-small">Edit</a>
                    
                    <button onclick="showRestockModal({{ item.inventory_id }}, '{{ item.item_name }}')" 
                            class="button button-small button-success">Restock</button>
                    
                    <form method="POST" 
                          action="{{ url_for('delete_inventory', inventory_id=item.inventory_id) }}" 
                          style="display: inline;"
                          onsubmit="return confirm('Delete {{ item.item_name }}? This cannot be undone!')">
                        <button type="submit" class="button button-small button-danger">Delete</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Restock Modal -->
<div id="restockModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
    <div style="background: white; max-width: 500px; margin: 100px auto; padding: 2rem; border-radius: 8px;">
        <h3 id="modalTitle">Restock Item</h3>
        <form method="POST" id="restockForm">
            <div class="field-group">
                <label>Quantity Received</label>
                <input type="number" name="quantity" class="input-field" step="0.01" min="0.01" required>
            </div>
            <button type="submit" class="button button-primary">Update Stock</button>
            <button type="button" onclick="closeRestockModal()" class="button">Cancel</button>
        </form>
    </div>
</div>

<script>
function showRestockModal(id, name) {
    document.getElementById('modalTitle').textContent = 'Restock: ' + name;
    document.getElementById('restockForm').action = '/inventory/' + id + '/update';
    document.getElementById('restockModal').style.display = 'block';
}

function closeRestockModal() {
    document.getElementById('restockModal').style.display = 'none';
}
</script>
{% endblock %}